<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSC Study Plan Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .admin-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .admin-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .admin-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .form-section {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .subject-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .subject-item input[type="checkbox"] {
            width: auto;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .results {
            background: #f8f9fa;
            padding: 30px;
            border-top: 3px solid #4facfe;
            display: none;
        }

        .results h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .study-allocation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .subject-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #4facfe;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .subject-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #333;
        }

        .study-hours {
            font-size: 1.5rem;
            color: #4facfe;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .focus-areas {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .exam-tips {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .exam-tips ul {
            margin: 5px 0;
            padding-left: 15px;
            font-size: 0.85rem;
        }

        .common-mistakes {
            margin-top: 8px;
            font-size: 0.85rem;
        }

        .recommendations {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #28a745;
            margin-bottom: 20px;
        }

        .recommendations h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .recommendations ul {
            list-style: none;
        }

        .recommendations li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .recommendations li::before {
            content: "‚Ä¢";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal h3 {
            margin-bottom: 15px;
            color: #4facfe;
            border-bottom: 2px solid #4facfe;
            padding-bottom: 5px;
        }

        .admin-form {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .admin-form input, .admin-form select, .admin-form textarea {
            margin-bottom: 10px;
        }

        .admin-form textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
        }

        .btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #3a8bdb;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .final-note {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }

        .final-note p {
            margin: 0;
            font-style: italic;
            color: #666;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-section {
                padding: 20px;
            }
            
            .subjects-grid {
                grid-template-columns: 1fr;
            }

            .admin-buttons {
                flex-direction: column;
                align-items: center;
            }

            .modal-content {
                margin: 20px;
                padding: 20px;
                max-height: 90vh;
            }
        }

        #importFile {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì HSC Study Plan Generator</h1>
            <p>AI-powered personalized study plans for Year 12 students</p>
            <div class="admin-buttons">
                <button id="adminBtn" class="admin-btn">‚öôÔ∏è Admin Panel</button>
                <button id="exportBtn" class="admin-btn">üì• Export Data</button>
                <button id="importBtn" class="admin-btn">üì§ Import Data</button>
            </div>
            <input type="file" id="importFile" accept=".json">
        </div>

        <div class="form-section">
            <form id="studyPlanForm">
                <div class="form-group">
                    <label for="targetAtar">Target ATAR:</label>
                    <input type="number" id="targetAtar" min="30" max="99.95" step="0.05" value="85" required>
                </div>

                <div class="form-group">
                    <label for="studyHours">Available Study Hours per Week:</label>
                    <input type="number" id="studyHours" min="5" max="50" value="20" required>
                </div>

                <div class="form-group">
                    <label for="weeksRemaining">Weeks Until HSC Exams:</label>
                    <input type="number" id="weeksRemaining" min="1" max="52" value="25" required>
                </div>

                <div class="form-group">
                    <label>Select Your HSC Subjects:</label>
                    <div class="subjects-grid" id="subjectsGrid">
                        <!-- Subjects will be populated by JavaScript -->
                    </div>
                </div>

                <div class="form-group">
                    <label>Current Grades (optional - helps personalize your plan):</label>
                    <div id="gradesSection">
                        <!-- Grade inputs will be added dynamically -->
                    </div>
                </div>

                <button type="submit" class="generate-btn">
                    Generate My Study Plan üöÄ
                </button>
            </form>
        </div>

        <div class="results" id="results">
            <h2>üìã Your Personalized HSC Study Plan</h2>
            <div id="studyPlan">
                <!-- Study plan will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2>‚öôÔ∏è Knowledge Bank Admin Panel</h2>
            
            <div class="admin-form">
                <h3>Add New Subject</h3>
                <input type="text" id="newSubjectName" placeholder="Subject Name">
                <input type="number" id="newSubjectDifficulty" placeholder="Difficulty (1-10)" min="1" max="10">
                <input type="number" id="newSubjectHours" placeholder="Weekly Hours" min="1" max="20">
                <input type="text" id="newSubjectFocus" placeholder="Focus Areas (comma separated)">
                <textarea id="newSubjectTips" placeholder="Exam Tips (one per line)" rows="3"></textarea>
                <button id="addSubjectBtn" class="btn">Add Subject</button>
            </div>

            <div class="admin-form">
                <h3>Add Study Tip</h3>
                <select id="tipCategory">
                    <option value="time_management">Time Management</option>
                    <option value="exam_preparation">Exam Preparation</option>
                    <option value="stress_management">Stress Management</option>
                    <option value="memory_techniques">Memory Techniques</option>
                </select>
                <input type="text" id="newTip" placeholder="Enter new study tip">
                <button id="addTipBtn" class="btn btn-success">Add Tip</button>
            </div>

            <div style="text-align: right;">
                <button id="closeAdminBtn" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Knowledge Bank Management System
        class KnowledgeBank {
            constructor() {
                this.subjects = {};
                this.studyTips = {};
                this.examStrategies = {};
                this.loadDefaultData();
            }

            async loadKnowledgeBank() {
                try {
                    const response = await fetch('knowledge-bank.json');
                    if (response.ok) {
                        const data = await response.json();
                        this.subjects = data.subjects || {};
                        this.studyTips = data.studyTips || {};
                        this.examStrategies = data.examStrategies || {};
                        console.log('‚úÖ Knowledge bank loaded from JSON file');
                        return;
                    }
                } catch (error) {
                    console.log('üìù No external knowledge bank found, using default data');
                }

                const stored = localStorage.getItem('hsc-knowledge-bank');
                if (stored) {
                    const data = JSON.parse(stored);
                    this.subjects = data.subjects || {};
                    this.studyTips = data.studyTips || {};
                    this.examStrategies = data.examStrategies || {};
                    console.log('‚úÖ Knowledge bank loaded from local storage');
                } else {
                    console.log('üìö Using default knowledge bank');
                }
            }

            saveKnowledgeBank() {
                const data = {
                    subjects: this.subjects,
                    studyTips: this.studyTips,
                    examStrategies: this.examStrategies,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('hsc-knowledge-bank', JSON.stringify(data));
                console.log('üíæ Knowledge bank saved to local storage');
            }

            addSubject(name, data) {
                this.subjects[name] = {
                    difficulty: data.difficulty || 5,
                    weeklyHours: data.weeklyHours || 4,
                    focus: data.focus || [],
                    prerequisites: data.prerequisites || [],
                    examTips: data.examTips || [],
                    commonMistakes: data.commonMistakes || [],
                    resources: data.resources || [],
                    ...data
                };
                this.saveKnowledgeBank();
                console.log(`üìö Added/Updated subject: ${name}`);
            }

            addStudyTip(category, tip) {
                if (!this.studyTips[category]) {
                    this.studyTips[category] = [];
                }
                this.studyTips[category].push(tip);
                this.saveKnowledgeBank();
            }

            getSubject(name) {
                return this.subjects[name] || {
                    difficulty: 5,
                    weeklyHours: 4,
                    focus: ['General Study'],
                    examTips: [],
                    commonMistakes: [],
                    resources: []
                };
            }

            loadDefaultData() {
                this.subjects = {
                    'Mathematics Extension 2': {
                        difficulty: 10,
                        weeklyHours: 8,
                        focus: ['Complex Numbers', 'Integration', 'Mechanics', 'Proof'],
                        prerequisites: ['Mathematics Extension 1'],
                        examTips: ['Practice proof writing', 'Master complex number operations', 'Time management crucial'],
                        commonMistakes: ['Rushing through proofs', 'Not showing all working', 'Poor notation'],
                        resources: ['Cambridge textbook', 'Past HSC papers', 'Online tutorials']
                    },
                    'Mathematics Extension 1': {
                        difficulty: 9,
                        weeklyHours: 6,
                        focus: ['Functions', 'Calculus', 'Combinatorics', 'Probability'],
                        prerequisites: ['Mathematics Advanced'],
                        examTips: ['Learn probability trees', 'Practice differentiation speed', 'Memorize key formulas'],
                        commonMistakes: ['Combinatorics confusion', 'Integration errors', 'Probability misconceptions'],
                        resources: ['Fitzpatrick textbook', 'THSC online', 'Study groups']
                    },
                    'Mathematics Advanced': {
                        difficulty: 7,
                        weeklyHours: 5,
                        focus: ['Calculus', 'Statistics', 'Financial Math', 'Trigonometry'],
                        prerequisites: ['Year 11 Mathematics'],
                        examTips: ['Calculator efficiency', 'Statistical interpretation', 'Financial math applications'],
                        commonMistakes: ['Calculator errors', 'Units in financial math', 'Statistical bias'],
                        resources: ['Maths in Focus', 'Excel for statistics', 'Financial calculators']
                    },
                    'Physics': {
                        difficulty: 8,
                        weeklyHours: 6,
                        focus: ['Mechanics', 'Electricity', 'Waves', 'Modern Physics'],
                        prerequisites: ['Mathematics Advanced recommended'],
                        examTips: ['Diagram everything', 'Unit analysis', 'Practice calculations daily'],
                        commonMistakes: ['Wrong units', 'Vector confusion', 'Formula misapplication'],
                        resources: ['Jacaranda textbook', 'PhET simulations', 'Practical experiments']
                    },
                    'Chemistry': {
                        difficulty: 8,
                        weeklyHours: 6,
                        focus: ['Organic Chemistry', 'Acids/Bases', 'Equilibrium', 'Production'],
                        prerequisites: ['Year 11 Chemistry'],
                        examTips: ['Memorize reaction equations', 'Practice nomenclature', 'Understand mechanisms'],
                        commonMistakes: ['Balancing equations', 'pH calculations', 'Organic naming'],
                        resources: ['Conquering Chemistry', 'ChemSketch', 'Lab experiments']
                    },
                    'Biology': {
                        difficulty: 6,
                        weeklyHours: 5,
                        focus: ['Heredity', 'Genetic Change', 'Infectious Disease', 'Non-infectious Disease'],
                        prerequisites: ['Year 11 Biology'],
                        examTips: ['Draw detailed diagrams', 'Learn scientific names', 'Practice data analysis'],
                        commonMistakes: ['Terminology confusion', 'Incomplete diagrams', 'Statistics errors'],
                        resources: ['Excel Biology', 'Scientific journals', 'Microscopy practice']
                    },
                    'English Advanced': {
                        difficulty: 7,
                        weeklyHours: 5,
                        focus: ['Texts and Context', 'Close Study', 'Craft of Writing', 'Reading to Write'],
                        prerequisites: ['Strong Year 11 English'],
                        examTips: ['Memorize quotes', 'Practice essay structure', 'Analyze literary techniques'],
                        commonMistakes: ['Poor time management', 'Weak thesis', 'Insufficient quotes'],
                        resources: ['Study guides', 'Past papers', 'Teacher feedback']
                    },
                    'English Standard': {
                        difficulty: 5,
                        weeklyHours: 4,
                        focus: ['Close Study', 'Texts and Context', 'Contemporary Possibilities', 'Literature'],
                        prerequisites: ['Year 11 English'],
                        examTips: ['Focus on comprehension', 'Practice writing speed', 'Understand rubrics'],
                        commonMistakes: ['Not answering the question', 'Poor paragraph structure', 'Weak examples'],
                        resources: ['Excel Study Guides', 'BBC Learning', 'Writing workshops']
                    },
                    'Modern History': {
                        difficulty: 6,
                        weeklyHours: 4,
                        focus: ['National Study', 'Peace and Conflict', 'Change in Modern World'],
                        examTips: ['Use historical examples', 'Structure arguments clearly', 'Reference sources'],
                        commonMistakes: ['Weak evidence', 'Poor chronology', 'Biased arguments'],
                        resources: ['Past papers', 'Historical documentaries', 'Primary sources']
                    },
                    'Economics': {
                        difficulty: 7,
                        weeklyHours: 5,
                        focus: ['Markets', 'Australia\'s Place', 'Economic Issues', 'Economic Policies'],
                        examTips: ['Use current examples', 'Draw economic diagrams', 'Analyze statistics'],
                        commonMistakes: ['Outdated examples', 'Poor diagram labels', 'Weak analysis'],
                        resources: ['RBA website', 'Economic newspapers', 'Statistical data']
                    }
                };

                this.studyTips = {
                    'time_management': [
                        'Use Pomodoro Technique (25 min study, 5 min break)',
                        'Create weekly timetables with specific goals',
                        'Priority matrix: urgent vs important tasks'
                    ],
                    'exam_preparation': [
                        'Start revision 6-8 weeks before exams',
                        'Practice past papers under timed conditions',
                        'Create summary sheets for each topic'
                    ],
                    'stress_management': [
                        'Regular exercise and adequate sleep',
                        'Mindfulness and breathing exercises',
                        'Talk to counselors or trusted adults'
                    ],
                    'memory_techniques': [
                        'Use spaced repetition for memorizing facts',
                        'Create memory palaces for complex information',
                        'Teach concepts to others to reinforce learning'
                    ]
                };
            }

            exportData() {
                return JSON.stringify({
                    subjects: this.subjects,
                    studyTips: this.studyTips,
                    examStrategies: this.examStrategies,
                    exported: new Date().toISOString()
                }, null, 2);
            }

            importData(jsonString) {
                try {
                    const data = JSON.parse(jsonString);
                    this.subjects = { ...this.subjects, ...data.subjects };
                    this.studyTips = { ...this.studyTips, ...data.studyTips };
                    this.examStrategies = { ...this.examStrategies, ...data.examStrategies };
                    this.saveKnowledgeBank();
                    console.log('‚úÖ Knowledge bank imported successfully');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error importing knowledge bank:', error);
                    return false;
                }
            }
        }

        // Enhanced Study Planner
        class EnhancedStudyPlanner {
            constructor(knowledgeBank) {
                this.kb = knowledgeBank;
            }

            async generatePlan(studentData) {
                await this.kb.loadKnowledgeBank();

                const { subjects, targetAtar, studyHours, weeksRemaining, grades } = studentData;
                const plan = {
                    subjectAllocation: {},
                    recommendations: [],
                    examStrategies: {},
                    resources: {},
                    studyTips: []
                };

                let totalDifficulty = 0;
                const subjectData = [];

                subjects.forEach(subject => {
                    const info = this.kb.getSubject(subject);
                    totalDifficulty += info.difficulty;
                    subjectData.push({ name: subject, ...info });
                });

                subjectData.forEach(subject => {
                    let baseAllocation = (subject.difficulty / totalDifficulty) * studyHours;
                    
                    const currentGrade = grades[subject.name] || 70;
                    if (currentGrade < 60) {
                        baseAllocation *= 1.4;
                        plan.recommendations.push(`üìö Focus extra time on ${subject.name} - current performance needs improvement`);
                        
                        if (subject.commonMistakes.length > 0) {
                            plan.recommendations.push(`‚ö†Ô∏è ${subject.name}: Avoid ${subject.commonMistakes[0]}`);
                        }
                    } else if (currentGrade > 85) {
                        baseAllocation *= 0.8;
                        plan.recommendations.push(`‚úÖ Maintain strong performance in ${subject.name}`);
                    }

                    if (targetAtar > 90) {
                        baseAllocation *= 1.2;
                    }

                    if (weeksRemaining < 10) {
                        baseAllocation *= 1.3;
                        if (!plan.recommendations.find(r => r.includes('exam revision'))) {
                            plan.recommendations.push('üïí Focus on exam revision and past papers');
                        }
                        plan.examStrategies[subject.name] = subject.examTips;
                    }

                    plan.subjectAllocation[subject.name] = {
                        weeklyHours: Math.round(baseAllocation * 10) / 10,
                        focusAreas: subject.focus.slice(0, 3),
                        examTips: subject.examTips,
                        commonMistakes: subject.commonMistakes
                    };

                    if (subject.resources.length > 0) {
                        plan.resources[subject.name] = subject.resources;
                    }
                });

                if (targetAtar > 95) {
                    plan.studyTips.push(...this.kb.studyTips['exam_preparation'] || []);
                }
                if (studyHours > 30) {
                    plan.studyTips.push(...this.kb.studyTips['stress_management'] || []);
                }
                if (weeksRemaining < 12) {
                    plan.studyTips.push(...this.kb.studyTips['time_management'] || []);
                }

                return plan;
            }
        }

        // Initialize
        const knowledgeBank = new KnowledgeBank();
        let planner;

        document.addEventListener('DOMContentLoaded', async function() {
            const subjectsGrid = document.getElementById('subjectsGrid');
            const gradesSection = document.getElementById('gradesSection');
            const studyPlanForm = document.getElementById('studyPlanForm');
            
            await knowledgeBank.loadKnowledgeBank();
            planner = new EnhancedStudyPlanner(knowledgeBank);

            setupAdminPanel();
            populateSubjects();

            subjectsGrid.addEventListener('change', function() {
                const selectedSubjects = Array.from(document.querySelectorAll('input[name="subjects"]:checked'))
                    .map(input => input.value);
                
                gradesSection.innerHTML = '';
                selectedSubjects.forEach(subject => {
                    const gradeDiv = document.createElement('div');
                    gradeDiv.style.marginBottom = '10px';
                    gradeDiv.innerHTML = `
                        <label for="grade-${subject.replace(/\s+/g, '')}">${subject} - Current Grade (%):</label>
                        <input type="number" id="grade-${subject.replace(/\s+/g, '')}" min="0" max="100" placeholder="Optional">
                    `;
                    gradesSection.appendChild(gradeDiv);
                });
            });

            studyPlanForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(studyPlanForm);
                const selectedSubjects = Array.from(document.querySelectorAll('input[name="subjects"]:checked'))
                    .map(input => input.value);
                
                if (selectedSubjects.length === 0) {
                    alert('Please select at least one subject!');
                    return;
                }

                const grades = {};
                selectedSubjects.forEach(subject => {
                    const gradeInput = document.getElementById(`grade-${subject.replace(/\s+/g, '')}`);
                    if (gradeInput && gradeInput.value) {
                        grades[subject] = parseInt(gradeInput.value);
                    }
                });

                const studentData = {
                    subjects: selectedSubjects,
                    targetAtar: parseFloat(formData.get('targetAtar') || 85),
                    studyHours: parseInt(formData.get('studyHours') || 20),
                    weeksRemaining: parseInt(formData.get('weeksRemaining') || 25),
                    grades: grades
                };

                const studyPlan = await planner.generatePlan(studentData);
                displayStudyPlan(studyPlan, studentData);
            });
        });

        function populateSubjects() {
            const subjectsGrid = document.getElementById('subjectsGrid');
            subjectsGrid.innerHTML = '';
            
            Object.keys(knowledgeBank.subjects).forEach(subject => {
                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'subject-item';
                subjectDiv.innerHTML = `
                    <input type="checkbox" id="${subject.replace(/\s+/g, '')}" name="subjects" value="${subject}">
                    <label for="${subject.replace(/\s+/g, '')}">${subject}</label>
                `;
                subjectsGrid.appendChild(subjectDiv);
            });
        }

        function setupAdminPanel() {
            const adminBtn = document.getElementById('adminBtn');
            const adminModal = document.getElementById('adminModal');
            const closeAdminBtn = document.getElementById('closeAdminBtn');
            const addSubjectBtn = document.getElementById('addSubjectBtn');
            const addTipBtn = document.getElementById('addTipBtn');
            const exportBtn = document.getElementById('exportBtn');
            const importBtn = document.getElementById('importBtn');
            const importFile = document.getElementById('importFile');

            adminBtn.addEventListener('click', () => {
                adminModal.style.display = 'block';
            });

            closeAdminBtn.addEventListener('click', () => {
                adminModal.style.display = 'none';
            });

            addSubjectBtn.addEventListener('click', () => {
                const name = document.getElementById('newSubjectName').value;
                const difficulty = parseInt(document.getElementById('newSubjectDifficulty').value);
                const hours = parseInt(document.getElementById('newSubjectHours').value);
                const focus = document.getElementById('newSubjectFocus').value.split(',').map(s => s.trim());
                const tips = document.getElementById('newSubjectTips').value.split('\n').filter(t => t.trim());

                if (name && difficulty && hours) {
                    knowledgeBank.addSubject(name, {
                        difficulty: difficulty,
                        weeklyHours: hours,
                        focus: focus,
                        examTips: tips,
                        commonMistakes: [],
                        resources: []
                    });
                    
                    alert(`‚úÖ Subject "${name}" added successfully!`);
                    
                    // Clear form
                    document.getElementById('newSubjectName').value = '';
                    document.getElementById('newSubjectDifficulty').value = '';
                    document.getElementById('newSubjectHours').value = '';
                    document.getElementById('newSubjectFocus').value = '';
                    document.getElementById('newSubjectTips').value = '';
                    
                    // Refresh subjects list
                    populateSubjects();
                } else {
                    alert('‚ùå Please fill in all required fields');
                }
            });

            addTipBtn.addEventListener('click', () => {
                const category = document.getElementById('tipCategory').value;
                const tip = document.getElementById('newTip').value;

                if (tip) {
                    knowledgeBank.addStudyTip(category, tip);
                    alert(`‚úÖ Study tip added to ${category}!`);
                    document.getElementById('newTip').value = '';
                } else {
                    alert('‚ùå Please enter a study tip');
                }
            });

            exportBtn.addEventListener('click', () => {
                const data = knowledgeBank.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'hsc-knowledge-bank.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('üì• Knowledge bank exported successfully!');
            });

            importBtn.addEventListener('click', () => {
                importFile.click();
            });

            importFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const success = knowledgeBank.importData(e.target.result);
                        if (success) {
                            alert('üì§ Knowledge bank imported successfully! Refreshing subjects...');
                            populateSubjects();
                        } else {
                            alert('‚ùå Error importing knowledge bank. Please check file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // Close modal when clicking outside
            adminModal.addEventListener('click', (e) => {
                if (e.target === adminModal) {
                    adminModal.style.display = 'none';
                }
            });
        }

        function displayStudyPlan(plan, studentData) {
            const resultsDiv = document.getElementById('results');
            const studyPlanDiv = document.getElementById('studyPlan');

            let html = `
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üìä Study Plan Overview</h3>
                    <p><strong>Target ATAR:</strong> ${studentData.targetAtar}</p>
                    <p><strong>Total Weekly Hours:</strong> ${studentData.studyHours}</p>
                    <p><strong>Weeks Until HSC:</strong> ${studentData.weeksRemaining}</p>
                </div>

                <div class="study-allocation">
            `;

            Object.entries(plan.subjectAllocation).forEach(([subject, details]) => {
                html += `
                    <div class="subject-card">
                        <div class="subject-name">${subject}</div>
                        <div class="study-hours">${details.weeklyHours} hours/week</div>
                        <div class="focus-areas">
                            <strong>Focus Areas:</strong> ${details.focusAreas.join(', ')}
                        </div>
                `;
                
                if (details.examTips && details.examTips.length > 0) {
                    html += `
                        <div class="exam-tips">
                            <strong>üí° Exam Tips:</strong>
                            <ul>
                                ${details.examTips.slice(0, 2).map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (details.commonMistakes && details.commonMistakes.length > 0) {
                    html += `
                        <div class="common-mistakes">
                            <strong style="color: #dc3545;">‚ö†Ô∏è Avoid:</strong> 
                            <span>${details.commonMistakes[0]}</span>
                        </div>
                    `;
                }
                
                html += `</div>`;
            });

            html += `</div>`;

            // Add study tips if available
            if (plan.studyTips && plan.studyTips.length > 0) {
                html += `
                    <div class="recommendations">
                        <h3>üí° Study Tips</h3>
                        <ul>
                `;
                plan.studyTips.forEach(tip => {
                    html += `<li>${tip}</li>`;
                });
                html += `</ul></div>`;
            }

            // Add resources if available
            if (plan.resources && Object.keys(plan.resources).length > 0) {
                html += `
                    <div class="recommendations" style="border-left-color: #17a2b8;">
                        <h3>üìö Recommended Resources</h3>
                `;
                Object.entries(plan.resources).forEach(([subject, resources]) => {
                    html += `
                        <div style="margin-bottom: 15px;">
                            <strong>${subject}:</strong>
                            <ul style="margin-top: 5px;">
                                ${resources.map(resource => `<li>${resource}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            // Add general recommendations
            html += `
                <div class="recommendations">
                    <h3>üìã Personalized Recommendations</h3>
                    <ul>
            `;

            plan.recommendations.forEach(rec => {
                html += `<li>${rec}</li>`;
            });

            html += `
                    </ul>
                    <div class="final-note">
                        <p>
                            <strong>üí° Remember:</strong> This AI-generated plan is based on your knowledge bank data and should be adjusted based on your learning style and specific needs. 
                            Good luck with your HSC preparation! üçÄ
                        </p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">
                            üîÑ You can update the knowledge bank anytime using the Admin Panel to improve future recommendations.
                        </p>
                    </div>
                </div>
            `;

            studyPlanDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
